hosts: influxdb
 sudo: True
 gather_facts: yes
 remote_user: "{{ansible_ssh_user}}"

 tasks:
   - name: Remove influxdb container
     shell: "sudo docker rm --force {{influxdb_container_name}}"
     ignore_errors: yes

   - name: Create influxdb directory # guarantee docker container can write
     file: "path={{influxdb_data_location}} state=directory owner=root group=root mode=0777 recurse=yes"

   - name: Start influxdb docker image
     shell: "sudo docker run -d --privileged -p {{influxdb_http_port}}:8083  -p {{influxdb_port}}:8086 --name {{influxdb_container_name}} -v {{influxdb_data_location}}:/var/lib/influxdb {{influxdb_image}}:{{influxdb_version}}"
